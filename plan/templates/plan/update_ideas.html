 {% load static %}

<!-- Online Ideas -->
    <div id="online-idea-container">
        <section class="p-5">
            <div class="container">
                <h2 class="text-center mb-md-5"> Discover the Online Ideas</h2>
                <div class="row align-items-center justify-content-between">


                    {% for idea in category.online_idea.all %}
                        <div class="col-md">

                            {#todo use dynamic urls to pass the corresponding idea object to the idea_overview page, passing the primary#}

                            {% if user.is_authenticated %}
                                {# Checkbox#}
                                <div class="row">


                                    <input type="checkbox" class="idea-checkbox" id="{{ idea.id }}-idea"
                                            {#                        The ideas that have been already chosen by users are ticked off by default#}
                                            {% if idea.id in ideas_list %}
                                           checked
                                            {% endif %}
                                    >
                                </div>

                            {% endif %}

                            <div class="row">
                                <a href="{% url 'idea_overview_detail' current_category idea.id 'overview' %}"
                                   class="btn">
                                    <div class="card bg-body text-black">
                                        <div class="card-body text-center">
                                            <div class="h1 mb-3">
                                                <i class="bi bi-journal-code"></i>
                                            </div>
                                            <h3 class="card-title mb-3 bg-light">{{ idea.idea_name }}</h3>
                                            <p class="card-text">

                                                idea's brief description


                                            </p>
                                        </div>
                                    </div>
                                </a>
                            </div>


                        </div>

                    {% endfor %}


                </div>
            </div>
        </section>
    </div>

{#   <script src="{% static 'plan/js/add_delete_idea.js' %}"></script>#}

<script>


    // user can delete/add an idea to her plan by ticking off the checkbox found on the idea overview page.
const idea_checkbox = document.getElementsByClassName('idea-checkbox')


// get requests sent are handle by use_idea view
for (i of idea_checkbox) {
    i.addEventListener('click', (event) => {

        if (event.currentTarget.checked) {
            alert('Online Idea Added to your course plan');
            // request managed by use_idea view, that subsequently adds idea to the course plan.


            $.ajax(
                {
                    type: 'GET',
                    //url: i.id + '/save_idea/'
                    url: '/use_idea/',
                    data: {
                        idea_id: (event.target.id ).split('-')[0], //Online Idea id.
                        plan_name_dom: document.getElementById('plan_name_dom').innerText

                    }
                }
            )

        } else {
            alert('not checked');
            // Delete idea from the course plan (PlanCategoryOnlineIdea Object)
            $.ajax(
                {
                    type: 'GET',
                    url: '/use_idea/',
                    data: {
                        idea_id: (event.target.id ).split('-')[0],     //Online Idea id.
                        delete_idea: true,
                        plan_name_dom: document.getElementById('plan_name_dom').innerText
                    }
                }
            )
        }


    })

}




</script>
